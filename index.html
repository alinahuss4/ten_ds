<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>London Crime Dispatcher Dashboard</title>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 320px 1fr 300px;
            grid-template-rows: 60px 1fr 200px;
            height: 100vh;
            gap: 1px;
            background: #333;
        }

        .header {
            grid-column: 1 / -1;
            background: #2c3e50;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid #e74c3c;
        }

        .header h1 {
            color: #ecf0f1;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .emergency-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #27ae60;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .sidebar {
            background: #34495e;
            padding: 20px;
            overflow-y: auto;
        }

        .call-panel {
            background: #2c3e50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .call-panel h3 {
            color: #e74c3c;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .transcript-box {
            background: #1a1a1a;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 10px;
            height: 120px;
            overflow-y: auto;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-section h4 {
            color: #ecf0f1;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #2c3e50;
            color: #ecf0f1;
            font-size: 0.9rem;
        }

        .map-container {
            position: relative;
            background: #2c3e50;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(44, 62, 80, 0.9);
            border-radius: 8px;
            padding: 15px;
            min-width: 200px;
        }

        .info-panel {
            background: #34495e;
            padding: 20px;
            overflow-y: auto;
        }

        .info-card {
            background: #2c3e50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }

        .info-card h4 {
            color: #3498db;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .timeline {
            grid-column: 1 / -1;
            background: #34495e;
            padding: 15px 20px;
        }

        .timeline h4 {
            color: #ecf0f1;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .timeline-chart {
            height: 140px;
        }

        .btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 5px 0;
            width: 100%;
        }

        .btn:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #3498db;
        }

        .btn-secondary:hover {
            background: #2980b9;
        }

        .alert {
            background: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 0.85rem;
        }

        .recent-calls {
            max-height: 200px;
            overflow-y: auto;
        }

        .call-item {
            background: #1a1a1a;
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 0.8rem;
            border-left: 3px solid #f39c12;
        }

        .call-time {
            color: #95a5a6;
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <header class="header">
            <h1><i class="fas fa-shield-alt"></i> Metropolitan Police - Dispatch Control</h1>
            <div class="emergency-status">
                <div class="status-indicator"></div>
                <span>System Online</span>
                <span id="current-time"></span>
            </div>
        </header>

        <aside class="sidebar">
            <div class="call-panel">
                <h3><i class="fas fa-phone"></i> Active Call</h3>
                <div class="transcript-box" id="live-transcript">
                    <div style="color: #95a5a6; font-style: italic;">Waiting for incoming call...</div>
                </div>
                <button class="btn" onclick="simulateCall()">Simulate Emergency Call</button>
                <button class="btn btn-secondary" onclick="clearCall()">Clear Call</button>
            </div>

            <div class="filter-section">
                <h4><i class="fas fa-filter"></i> Filters</h4>

                <div class="filter-group">
                    <label>Crime Type:</label>
                    <select id="crime-type-filter" onchange="updateFilters()">
                        <option value="">All Types</option>
                        <option value="Theft from the person">Theft from Person</option>
                        <option value="Bicycle theft">Bicycle Theft</option>
                        <option value="Shoplifting">Shoplifting</option>
                        <option value="Other theft">Other Theft</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Postcode Area:</label>
                    <input type="text" id="postcode-filter" placeholder="e.g., W1, SW1" onchange="updateFilters()">
                </div>

                <div class="filter-group">
                    <label>Date Range:</label>
                    <input type="date" id="date-from" onchange="updateFilters()">
                    <input type="date" id="date-to" onchange="updateFilters()">
                </div>

                <div class="filter-group">
                    <label>Time of Day:</label>
                    <select id="time-filter" onchange="updateFilters()">
                        <option value="">All Hours</option>
                        <option value="morning">Morning (6-12)</option>
                        <option value="afternoon">Afternoon (12-18)</option>
                        <option value="evening">Evening (18-24)</option>
                        <option value="night">Night (0-6)</option>
                    </select>
                </div>

                <button class="btn" onclick="resetFilters()">Reset Filters</button>
            </div>

            <div class="recent-calls">
                <h4><i class="fas fa-history"></i> Recent Calls</h4>
                <div id="recent-calls-list"></div>
            </div>
        </aside>

        <main class="map-container">
            <div id="map"></div>
            <div class="map-controls">
                <h4>Map Controls</h4>
                <label>
                    <input type="checkbox" id="show-heatmap" checked onchange="toggleHeatmap()">
                    Show Crime Heatmap
                </label><br>
                <label>
                    <input type="checkbox" id="show-incidents" checked onchange="toggleIncidents()">
                    Show Individual Incidents
                </label><br>
                <label>
                    <input type="checkbox" id="show-police-units" onchange="togglePoliceUnits()">
                    Show Police Units
                </label><br>
                <label>
                    <input type="range" id="heatmap-intensity" min="0" max="1" step="0.1" value="0.5" onchange="updateHeatmapIntensity()">
                    Heatmap Intensity
                </label>
            </div>
        </main>

        <aside class="info-panel">
            <div class="info-card">
                <h4><i class="fas fa-chart-bar"></i> Current Statistics</h4>
                <div class="stat-row">
                    <span>Total Incidents:</span>
                    <span id="total-incidents">0</span>
                </div>
                <div class="stat-row">
                    <span>Last Hour:</span>
                    <span id="recent-incidents">0</span>
                </div>
                <div class="stat-row">
                    <span>Active Units:</span>
                    <span id="active-units">12</span>
                </div>
            </div>

            <div class="info-card">
                <h4><i class="fas fa-map-marker-alt"></i> Hotspot Areas</h4>
                <div id="hotspot-areas"></div>
            </div>

            <div class="info-card">
                <h4><i class="fas fa-users"></i> Suspect Patterns</h4>
                <div id="suspect-patterns">
                    <div class="stat-row">
                        <span>Known Offenders in Area:</span>
                        <span>3</span>
                    </div>
                    <div class="stat-row">
                        <span>Similar MO (Last 24h):</span>
                        <span>7</span>
                    </div>
                </div>
            </div>

            <div class="info-card">
                <h4><i class="fas fa-car"></i> Resource Availability</h4>
                <div id="resources">
                    <div class="stat-row">
                        <span>Patrol Cars Available:</span>
                        <span>8/15</span>
                    </div>
                    <div class="stat-row">
                        <span>Average Response Time:</span>
                        <span>4.2 min</span>
                    </div>
                </div>
            </div>

            <div class="alert" id="priority-alert" style="display: none;">
                <strong>Priority Alert:</strong>
                <span id="alert-message"></span>
            </div>
        </aside>

        <section class="timeline">
            <h4><i class="fas fa-clock"></i> Crime Timeline (Last 24 Hours)</h4>
            <div class="timeline-chart" id="timeline-chart"></div>
        </section>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>